(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4e10f4f4"],{"275e":function(e,t,i){},3406:function(e,t,i){"use strict";i("275e")},"3fba":function(e,t,i){"use strict";i("b558")},"56c4":function(e,t,i){"use strict";i("c1f8")},"6c90":function(e,t,i){"use strict";var a=i("53ca"),n=i("b85c"),r=i("5530"),s=i("1da1"),c=i("d4ec"),o=i("bee2"),u=i("262e"),l=i("2caf"),d=(i("96cf"),i("99af"),i("b0c0"),i("2ca0"),i("d3b7"),i("3ca3"),i("ddb0"),i("7db0"),i("9ab4")),f=i("2b0e"),p=i("1237"),h=i("1b40"),b=i("d9fe"),v=i("bc3a"),m=i.n(v),g=i("6822"),y=function(e){Object(u["a"])(i,e);var t=Object(l["a"])(i);function i(){var e;return Object(c["a"])(this,i),e=t.apply(this,arguments),e.cancelTokenSource=void 0,e}return Object(o["a"])(i,[{key:"apiUrl",get:function(){return this.$store.state.config.apiUrl}},{key:"getThumbUrl",value:function(e,t,i,a){if(e.length){a||(a=(new Date).getTime());var n=Object(b["a"])(e,t,i);if(n&&n.absolute_path)return"".concat(n.absolute_path,"?cachebust=").concat(a);if(n&&n.data)return n.data}return""}},{key:"getGcode",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t){var i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.size/1024/1024,i=!0,!i){e.next=9;break}return this.cancelTokenSource=m.a.CancelToken.source(),a=t.path?"".concat(t.path,"/").concat(t.filename):t.filename,e.next=8,this.getFile(a,"gcodes",t.size,{responseType:"text",transformResponse:[function(e){return e}],cancelToken:this.cancelTokenSource.token});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getFile",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,i){var a,n,s,c,o,u=this,l=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=l.length>2&&void 0!==l[2]?l[2]:0,n=l.length>3?l[3]:void 0,s=i?"".concat(i,"/").concat(t):"".concat(t),c=performance.now(),this.$store.dispatch("files/updateFileDownload",{filepath:s,size:a,loaded:0,percent:0,speed:0,unit:"kB"}),o=Object(r["a"])(Object(r["a"])({},n),{},{onDownloadProgress:function(e){var t=["kB","MB","GB"],i=0,n=0,r=performance.now()-c;if(r>0){i=e.loaded/r;while(i>1024)i/=1024,n=Math.min(2,n+1)}var o={filepath:s,loaded:e.loaded,percent:Math.round(e.loaded/a*100),speed:i,unit:t[n]};e.lengthComputable&&(a=o.size=e.total),u.$store.dispatch("files/updateFileDownload",o)}}),e.next=8,p["a"].get(encodeURI(this.apiUrl+"/server/files/"+s+"?date="+(new Date).getTime()),o);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)})));function t(t,i){return e.apply(this,arguments)}return t}()},{key:"downloadFile",value:function(e,t){var i=this;g["a"].getOneShot().then((function(e){return e.data.result})).then((function(a){var n=t?"".concat(t,"/").concat(e):"".concat(e),r=encodeURI(i.apiUrl+"/server/files/"+n+"?token="+a+"&date="+(new Date).getTime()),s=document.createElement("a");s.href=r,s.setAttribute("download",e),s.setAttribute("target","_blank"),document.body.appendChild(s),s.click(),document.body.removeChild(s)})).catch((function(){}))}},{key:"uploadFile",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,i,a,n,s){var c,o,u,l=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return c=new FormData,o="".concat(i,"/").concat(t.name),o=o.startsWith("/")?o:"/"+o,c.append("file",t,o),c.append("root",a),n&&c.append("print","true"),u=performance.now(),this.$store.dispatch("files/updateFileUpload",{filepath:o,size:t.size,loaded:0,percent:0,speed:0,unit:"kB",cancelled:!1}),e.abrupt("return",p["a"].post(this.apiUrl+"/server/files/upload",c,Object(r["a"])(Object(r["a"])({},s),{},{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){var t=["kB","MB","GB"],i=0,a=0,n=performance.now()-u;if(n>0){i=e.loaded/n;while(i>1024)i/=1024,a=Math.min(2,a+1)}l.$store.dispatch("files/updateFileUpload",{filepath:o,loaded:e.loaded,percent:Math.round(e.loaded/e.total*100),speed:i,unit:t[a]})}})).then((function(e){return e})).catch((function(e){return e})).finally((function(){l.$store.dispatch("files/removeFileUpload",o)})));case 9:case"end":return e.stop()}}),e,this)})));function t(t,i,a,n,r){return e.apply(this,arguments)}return t}()},{key:"uploadFiles",value:function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(t,i,r,s){var c,o,u,l,d,f,p,h,b=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:c=Object(n["a"])(t);try{for(c.s();!(o=c.n()).done;)u=o.value,l="".concat(i,"/").concat(u.name),l=l.startsWith("/")?l:"/"+l,this.$store.dispatch("files/updateFileUpload",{filepath:l,size:u.size,loaded:0,percent:0,speed:0,unit:"kB",cancelled:!1})}catch(v){c.e(v)}finally{c.f()}t.length>1&&(s=!1),d=Object(n["a"])(t),e.prev=4,p=regeneratorRuntime.mark((function e(){var t,a,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=f.value,a="".concat(i,"/").concat(t.name),a=a.startsWith("/")?a:"/"+a,n=b.$store.state.files.uploads.find((function(e){return e.filepath===a})),n.cancelled){e.next=16;break}return e.prev=5,b.cancelTokenSource=m.a.CancelToken.source(),e.next=9,b.uploadFile(t,i,r,s,{cancelToken:b.cancelTokenSource.token});case 9:e.next=14;break;case 11:return e.prev=11,e.t0=e["catch"](5),e.abrupt("return",{v:e.t0});case 14:e.next=17;break;case 16:b.$store.dispatch("files/removeFileUpload",a);case 17:case"end":return e.stop()}}),e,null,[[5,11]])})),d.s();case 7:if((f=d.n()).done){e.next=14;break}return e.delegateYield(p(),"t0",9);case 9:if(h=e.t0,"object"!==Object(a["a"])(h)){e.next=12;break}return e.abrupt("return",h.v);case 12:e.next=7;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e["catch"](4),d.e(e.t1);case 19:return e.prev=19,d.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[4,16,19,22]])})));function t(t,i,a,n){return e.apply(this,arguments)}return t}()}]),i}(f["a"]);y=Object(d["a"])([h["a"]],y),t["a"]=y},"7bf1":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"print-history-page"},[i("div",{staticClass:"tab-wrap"},[i("FileTab",{directives:[{name:"show",rawName:"v-show",value:e.fileTabShow,expression:"fileTabShow"}],attrs:{currentTab:e.currentTab,fromType:"history"},on:{changeCurrentTab:e.changeCurrentTab}})],1),i("div",{staticClass:"print-history-list"},[i("HistoryItem",{attrs:{type:"title"}}),i("van-list",{staticClass:"history-list",attrs:{finished:e.finished,"immediate-check":!1,"finished-text":e.$t("File.noMore"),"loading-text":e.$t("File.loading")},on:{load:e.onLoad},model:{value:e.loading,callback:function(t){e.loading=t},expression:"loading"}},[e._l(e.viewHistoryList,(function(t,a){return["in_progress"!==t.status?i("HistoryItem",{key:a,attrs:{type:"content",item:t,index:a},on:{updateActiveIndex:e.updateActiveIndex,updateShowName:e.updateShowName}}):e._e()]}))],2)],1)])},n=[],r=i("5530"),s=i("2909"),c=i("d4ec"),o=i("bee2"),u=i("262e"),l=i("2caf"),d=(i("e9c4"),i("ac1f"),i("5319"),i("fb6a"),i("9ab4")),f=i("1b40"),p=i("2f62"),h=i("ff68"),b=i("6c90"),v=i("9265"),m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"history-item-page"},["title"===e.type?i("div",{staticClass:"table-row table-title"},[i("div",{staticClass:"clo-one"}),i("div",{staticClass:"clo-two"},[e._v(e._s(e.$t("PrintHistory.filename")))]),i("div",{staticClass:"clo-three"},[e._v(e._s(e.$t("newAdd.startEnd")))]),i("div",{staticClass:"clo-four"},[e._v(e._s(e.$t("newAdd.totalTime")))]),i("div",{staticClass:"clo-five"},[e._v(e._s(e.$t("PrintHistory.printResult")))]),i("div",{staticClass:"clo-six"},[e._v(e._s(e.$t("PrintHistory.operate")))])]):i("div",{staticClass:"table-row"},[i("div",{staticClass:"clo-one"},[e.imgUrlAddress?i("img",{attrs:{"data-error":0,src:e.imgUrlAddress,alt:""},on:{error:function(t){return e.handleError(t)}}}):e._e()]),i("div",{staticClass:"clo-two",on:{click:e.handleClickName}},[e._v(e._s(e.getFilePaths(e.item.filename)))]),i("div",{staticClass:"clo-three"},[i("span",[e._v(e._s(e.formatPrintTime(e.item.start_time)))]),i("span",[e._v(e._s(e.formatPrintTime(e.item.end_time)))])]),i("div",{staticClass:"clo-four"},[e._v(e._s(e.formatTime(e.item.end_time-e.item.start_time)))]),"completed"===e.item.status?i("div",{staticClass:"clo-five print-success"},[e._v(e._s(e.$t("PrintHistory.success")))]):i("div",{staticClass:"clo-five print-fail"},[e._v(e._s(e.$t("PrintHistory.failure")))]),i("div",{staticClass:"clo-six",on:{click:function(t){return e.goPrinting()}}},[e._v(e._s(e.$t("PrintHistory.rePrint")))]),e.item.showFileName?i("div",{staticClass:"full-filename",attrs:{id:"full-filename"}},[e._v(e._s(e.getFilePaths(e.item.filename)))]):e._e()]),e.isRequestLoading?i("cx-loading",{attrs:{visible:e.isRequestLoading,duration:3e4,closeCallBack:e.closeCallBack},on:{"update:visible":function(t){e.isRequestLoading=t}}},[e._v(" "+e._s(e.$t("Common.loading"))+" ")]):e._e()],1)},g=[],y=i("1da1"),k=(i("96cf"),i("00b4"),i("a9e3"),i("baba")),O=i("48b8"),w=i("c56f"),j=function(e){Object(u["a"])(a,e);var t=Object(l["a"])(a);function a(){var e;return Object(c["a"])(this,a),e=t.apply(this,arguments),e.imgUrlAddress="",e.isRequestLoading=!1,e}return Object(o["a"])(a,[{key:"printRequestStatus",get:function(){return this.$store.getters["printer/getPrintRequestRes"]}},{key:"onChangeRequestStatus",value:function(e){var t=this;if("success"===e&&"/PrintHistory"===this.$route.path)var i=setTimeout((function(){clearTimeout(i),t.$router.push({path:"/Printing"}),t.isRequestLoading=!1}),2e3);else"error"===e&&"/PrintHistory"===this.$route.path&&(this.$toast.fail(this.$t("File.printAddFail")),this.isRequestLoading=!1);this.$nextTick((function(){t.$store.dispatch("printer/onRequestRes","")}))}},{key:"getFilePaths",value:function(e){var t=Object(k["a"])(e,"gcodes");return/^U_/g.test(t.filename)?t.filename.substr(2):t.filename}},{key:"mounted",value:function(){"title"!==this.type&&this.getImgUrl()}},{key:"formatPrintTime",value:function(e){return Object(O["b"])(e)}},{key:"getImgUrl",value:function(){var e=Object(y["a"])(regeneratorRuntime.mark((function e(){var t,a,n,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t="/mnt/UDISK/.crealityprint/upload/",a=Object(k["a"])(this.item["filename"],"gcodes"),n={method:"get_png",params:{file_path:t+a.filename}},this.$httpClient({method:"post",url:"".concat(this.$backBaseUrl,"/files/"),data:n}).then((function(e){var t=(null===e||void 0===e?void 0:e.data)||{},a=t.code,n=t.data;r.imgUrlAddress="0000"===a&&n?"data:image/png;base64,"+n:i("cd337")("./"+r.$store.state.config.uiSettings.theme.theme+"/file/default.png")})).catch((function(){r.imgUrlAddress=i("cd337")("./"+r.$store.state.config.uiSettings.theme.theme+"/file/default.png")}));case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"goPrinting",value:function(){this.$audioPlay(),this.isRequestLoading=!0;var e=Object(k["a"])(this.item["filename"],"gcodes");w["a"].printerPrintStart("/"+(null===e||void 0===e?void 0:e.filename))}},{key:"closeCallBack",value:function(){this.$store.dispatch("printer/onRequestRes","")}},{key:"formatTime",value:function(e){var t=parseInt(e);if(!t||parseFloat(t)!=t)return 0+"".concat(this.$t("newAdd.minute"));var i=t/3600,a=parseInt(i),n=t%3600/60,r=parseInt(n);return a?a+"".concat(this.$t("newAdd.hour"))+r+"".concat(this.$t("newAdd.minute")):r+"".concat(this.$t("newAdd.minute"))}},{key:"handleClickName",value:function(){var e=this,t=setTimeout((function(){clearTimeout(t),e.$emit("updateActiveIndex",e.index),e.$emit("updateShowName",{index:e.index,isShow:!0})}),100)}}]),a}(Object(f["c"])(v["a"]));Object(d["a"])([Object(f["d"])({type:Object})],j.prototype,"item",void 0),Object(d["a"])([Object(f["d"])({type:String,required:!0})],j.prototype,"type",void 0),Object(d["a"])([Object(f["d"])({type:Number})],j.prototype,"index",void 0),Object(d["a"])([Object(f["h"])("printRequestStatus")],j.prototype,"onChangeRequestStatus",null),j=Object(d["a"])([Object(f["a"])({computed:Object(r["a"])({},Object(p["b"])(["config"]))})],j);var _=j,C=_,$=(i("3fba"),i("2877")),x=Object($["a"])(C,m,g,!1,null,"103b3936",null),T=x.exports,S=function(e){Object(u["a"])(i,e);var t=Object(l["a"])(i);function i(){var e;return Object(c["a"])(this,i),e=t.apply(this,arguments),e.fileTabShow=!0,e.currentTab={isDisable:!1,text:"File.historyPrint",type:4},e.currentHistory=[],e.currentActiveIndex="",e.currentPage=0,e.pageSize=10,e.viewHistoryList=[],e.loading=!0,e.finished=!1,e}return Object(o["a"])(i,[{key:"history",get:function(){var e=this.$store.getters["history/getUniqueHistory"](1e3);return this.currentHistory=JSON.parse(JSON.stringify(e)),e}},{key:"onHistoryChange",value:function(){}},{key:"mounted",value:function(){document.documentElement.addEventListener("click",this.handleGlobalClick,!0),this.onLoad()}},{key:"changeCurrentTab",value:function(e){this.$router.replace({name:"File",params:{currentTab:JSON.stringify(e)}})}},{key:"updateShowName",value:function(e){this.currentHistory[e.index]["showFileName"]=e.isShow}},{key:"updateActiveIndex",value:function(e){this.currentActiveIndex=e}},{key:"handleGlobalClick",value:function(e){if(""!==this.currentActiveIndex){var t=document.getElementById("full-filename");t&&!t.contains(e.target)&&this.updateShowName({index:this.currentActiveIndex,isShow:!1})}}},{key:"onLoad",value:function(){var e,t=this.currentPage*this.pageSize;this.currentPage+=1;var i=this.currentPage*this.pageSize,a=this.currentHistory.slice(t,i);(e=this.viewHistoryList).push.apply(e,Object(s["a"])(a)),this.loading=!1,i>=this.currentHistory.length&&(this.finished=!0)}},{key:"beforeDestrory",value:function(){document.documentElement.removeEventListener("click",this.handleGlobalClick)}}]),i}(Object(f["c"])(v["a"],b["a"]));Object(d["a"])([Object(f["h"])("history")],S.prototype,"onHistoryChange",null),S=Object(d["a"])([Object(f["a"])({components:{FileTab:h["a"],HistoryItem:T},computed:Object(r["a"])({},Object(p["b"])(["config"]))})],S);var F=S,R=F,P=(i("56c4"),Object($["a"])(R,a,n,!1,null,"3551b994",null));t["default"]=P.exports},a392:function(e,t,i){e.exports=i.p+"img/default.3bc62271.png"},b558:function(e,t,i){},c1f8:function(e,t,i){},cd337:function(e,t,i){var a={"./theme1/file/default.png":"a392"};function n(e){var t=r(e);return i(t)}function r(e){if(!i.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}n.keys=function(){return Object.keys(a)},n.resolve=r,e.exports=n,n.id="cd337"},ff68:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"file-tab-page"},[i("div",{staticClass:"tab-list"},e._l(e.tabList,(function(t,a){return i("div",{key:a,staticClass:"tab-item",class:{isActive:t.type===e.currentTab.type,isDisable:t.isDisable},on:{click:function(i){return e.changeCurrentTab(t)}}},[e._v(" "+e._s(e.$t(t.text))+" ")])})),0)])},n=[],r=i("d4ec"),s=i("bee2"),c=i("262e"),o=i("2caf"),u=(i("ac1f"),i("5319"),i("9ab4")),l=i("1b40"),d=function(e){Object(c["a"])(i,e);var t=Object(o["a"])(i);function i(){return Object(r["a"])(this,i),t.apply(this,arguments)}return Object(s["a"])(i,[{key:"udiskStatus",get:function(){return this.$store.state.common.udiskStatus}},{key:"tabList",get:function(){return[{isDisable:!1,text:"File.localFile",type:1},{isDisable:!this.udiskStatus,text:"File.upFile",type:2},{isDisable:!1,text:"File.createCloud",type:3},{isDisable:!1,text:"File.historyPrint",type:4}]}},{key:"changeCurrentTab",value:function(e){if(this.$audioPlay(),2!==e.type||this.udiskStatus)if(3!==e.type)if("file"===this.fromType){if(4===e.type)return void this.$router.replace("/PrintHistory");if(e.isDisable)return;this.$emit("changeCurrentTab",e)}else{if(4===e.type)return;this.$emit("changeCurrentTab",e)}else this.$emit("changeCurrentTab",e);else this.$toast.fail(this.$t("File.deskNotInsert"))}}]),i}(Object(l["c"])(l["g"]));Object(u["a"])([Object(l["d"])({type:Object,required:!0})],d.prototype,"currentTab",void 0),Object(u["a"])([Object(l["d"])({type:String,required:!0})],d.prototype,"fromType",void 0),d=Object(u["a"])([Object(l["a"])({})],d);var f=d,p=f,h=(i("3406"),i("2877")),b=Object(h["a"])(p,a,n,!1,null,"9f55a5b4",null);t["a"]=b.exports}}]);